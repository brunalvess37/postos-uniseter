<!DOCTYPE html>
<html lang="pt-BR">
<head>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Gerar Relatório — Postos UNISETER</title>

<script async crossorigin="anonymous"
  src="https://cdn.jsdelivr.net/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"
  data-clerk-publishable-key="pk_test_bHVja3ktc3RpbmtidWctODUuY2xlcmsuYWNjb3VudHMuZGV2JA">
</script>

<link rel="stylesheet" href="style.css?v=202501">

<style>
body{ display:none; padding:20px; }
.container{ max-width:640px; margin:auto; }

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:16px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
}

label{ font-weight:bold; display:block; margin:8px 0 4px; }
.radio-group label{ font-weight:normal; }

button{
  padding:10px 16px;
  border-radius:8px;
  cursor:pointer;
}

.primary{
  background:var(--primary);
  color:white;
  border:none;
  width:100%;
}

.secondary{
  background:transparent;
  border:1px solid var(--border);
  width:100%;
}

.hidden{ display:none; }
</style>

</head>

<body>

<script>
let usuarioRelatorio = null;

document.addEventListener("DOMContentLoaded", async ()=>{

  const c = window.Clerk;
  await c.load();

  if(!c.user) return location.href="/signin.html";

  usuarioRelatorio = {
    nome: c.user.fullName || "",
    email: c.user.primaryEmailAddress
      ? c.user.primaryEmailAddress.emailAddress
      : ""
  };

  document.body.style.display="block";
  atualizarEstadoBotoes();
});

function atualizarEstadoBotoes(){
  const tipo = document.querySelector("input[name=tipo]:checked").value;
  document.getElementById("btnGerar").disabled = (tipo === "manual");
  document.getElementById("btnManual").classList.toggle("hidden", tipo !== "manual");
}
</script>

<div class="container">

<header>
  <h2>Gerar Relatório</h2>
  <button type="button" onclick="location.href='home.html'">← Menu</button>
</header>

<p style="color:var(--muted)">Defina os critérios do relatório</p>

<div class="card">
  <label>Tipo de relatório</label>
  <div class="radio-group" onchange="atualizarEstadoBotoes()">
    <label><input type="radio" name="tipo" value="todos" checked> Todos os postos</label>
    <label><input type="radio" name="tipo" value="favoritos"> Apenas favoritos</label>
    <label><input type="radio" name="tipo" value="manual"> Seleção manual</label>
  </div>
</div>

<div class="card">
  <label>Ordenação</label>
  <div class="radio-group">
    <label><input type="radio" name="ordem" value="posto" checked> Nome do Posto</label>
    <label><input type="radio" name="ordem" value="zona"> Zona</label>
  </div>
</div>

<div class="card">
  <button
    id="btnGerar"
    type="button"
    class="primary"
    onclick="gerar()">
    Gerar PDF
  </button>

  <button
    id="btnManual"
    type="button"
    class="secondary hidden"
    onclick="location.href='relatorio-selecao.html'">
    Selecionar postos
  </button>
</div>

</div>

<!-- DEPENDÊNCIAS DO PDF -->
<script src="pdfmake.min.js?v=202501"></script>
<script src="vfs_fonts.js?v=202501"></script>

<!-- PDF -->
<script src="pdf-geral.js?v=202501"></script>

<script>
function gerar(){
  gerarPDFGeral({
    tipo: document.querySelector("input[name=tipo]:checked").value,
    ordem: document.querySelector("input[name=ordem]:checked").value,
    usuario: usuarioRelatorio
  });
}
</script>

</body>
</html>
